<!doctype html>
<html lang=en-US>
<meta charset=utf8>
<meta name="viewport" content="width=device-width, initial-scale=1"><title>ProseMirror schema ç¤ºä¾‹</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel=stylesheet href=/css/site.css>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-79359216-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-79359216-2');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5486286026923411"
     crossorigin="anonymous"></script>
<script async src="https://fundingchoicesmessages.google.com/i/pub-5486286026923411?ers=1" nonce="wfbcB_BXTEc885VHCZEEPg"></script><script nonce="wfbcB_BXTEc885VHCZEEPg">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>

<header >
  <nav>
    <a class=logo href="/">ProseMirror</a>
    <div class=navlinks><a href="/examples/" class=active>ç¤ºä¾‹</a>
      <a href="/docs/" >æ–‡æ¡£</a>
      <a href="https://discuss.prosemirror.net/">è®ºå›</a>
      <a href="https://github.com/prosemirror">GitHub</a>
      <a href="https://twitter.com/prosemirror">Twitter</a>
      <a href="https://github.com/Xheldon">è¯‘è€…</a>
    </div>
  </nav></header><article><h1>ä»é›¶å¼€å§‹å†™ä¸€ä¸ª Schema</h1>
<p>ProseMirror çš„ <a href="/docs/guide/#schema">schemas</a> ä¸ºæ–‡æ¡£æä¾›äº†ç±»ä¼¼è¯­æ³•ä¸€æ ·çš„ä¸œè¥¿--ä»–ä»¬å†³å®šå“ªäº›æ–‡æ¡£ç»“æ„æ˜¯æœ‰æ•ˆå¯ç”¨çš„ã€‚</p>
<p>æœ€ç®€å•çš„ schema å¯èƒ½ä»…ä»…æ˜¯ä¸€ä¸ªæœ‰æ–‡æœ¬èŠ‚ç‚¹ç»„æˆçš„æ–‡æ¡£ï¼š</p>
<pre><code class="language-javascript"><span class="hl-keyword">import</span> {<span class="hl-def">Schema</span>} <span class="hl-keyword">from</span> <span class="hl-string">"prosemirror-model"</span>

<span class="hl-keyword">const</span> <span class="hl-def">textSchema</span> <span class="hl-operator">=</span> <span class="hl-keyword">new</span> <span class="hl-variable">Schema</span>({
  <span class="hl-property">nodes</span>: {
    <span class="hl-property">text</span>: {},
    <span class="hl-property">doc</span>: {<span class="hl-property">content</span>: <span class="hl-string">"text*"</span>}
  }
})
</code></pre>
<p>ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ç¼–è¾‘è¡Œå†…å…ƒç´ ã€‚<span id="text-editor"></span> (ProseMirror çš„ view å¯ä»¥ <a href="/docs/ref/#view.EditorView.constructor">mounted(æŒ‚è½½)</a> åœ¨ä»»ä½•èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬è¡Œå†…èŠ‚ç‚¹)</p>
<h2>å—çº§èŠ‚ç‚¹</h2>
<p>ä¸ºäº†æ·»åŠ æ›´å¤šæ–‡æ¡£ç»“æ„ï¼Œä½ é€šå¸¸æƒ³è¦æ·»åŠ ä¸€äº›å—çº§èŠ‚ç‚¹ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸ª schema åŒ…å«ä¸€äº›å¤‡å¿˜ä¿¡æ¯èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥ï¼ˆå¯é€‰çš„ï¼‰ä¸å…¶ä»–å¤‡å¿˜ä¿¡æ¯ç»„æˆä¸€ä¸ªå¤‡å¿˜ä¿¡æ¯ç»„èŠ‚ç‚¹ï¼Œä»¥åˆ†ç»„æ˜¾ç¤ºï¼š</p>
<pre><code class="language-javascript"><span class="hl-keyword">const</span> <span class="hl-def">noteSchema</span> <span class="hl-operator">=</span> <span class="hl-keyword">new</span> <span class="hl-variable">Schema</span>({
  <span class="hl-property">nodes</span>: {
    <span class="hl-property">text</span>: {},
    <span class="hl-property">note</span>: {
      <span class="hl-property">content</span>: <span class="hl-string">"text*"</span>,
      <span class="hl-property">toDOM</span>() { <span class="hl-keyword">return</span> [<span class="hl-string">"note"</span>, <span class="hl-number">0</span>] },
      <span class="hl-property">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"note"</span>}]
    },
    <span class="hl-property">notegroup</span>: {
      <span class="hl-property">content</span>: <span class="hl-string">"note+"</span>,
      <span class="hl-property">toDOM</span>() { <span class="hl-keyword">return</span> [<span class="hl-string">"notegroup"</span>, <span class="hl-number">0</span>] },
      <span class="hl-property">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"notegroup"</span>}]
    },
    <span class="hl-property">doc</span>: {
      <span class="hl-property">content</span>: <span class="hl-string">"(note | notegroup)+"</span>
    }
  }
})
</code></pre>
<p>å¯¹äºä¸æ˜¯ text æˆ–è€…é¡¶çº§èŠ‚ç‚¹çš„èŠ‚ç‚¹æ¥è¯´ï¼Œæä¾›ä¸€ä¸ª <a href="/docs/ref/#model.NodeSpec.toDOM"><code>toDOM</code></a> æ–¹æ³•æ˜¯<a href="/docs/guide/#schema.serialization_and_parsing">å¿…è¦çš„</a>ï¼Œ
è¿™æ ·ä¸€æ¥ï¼Œç¼–è¾‘å™¨å¯ä»¥æ¸²æŸ“è¿™äº›èŠ‚ç‚¹ï¼›ä»¥åŠæä¾›ä¸€ä¸ª <a href="/docs/ref/#model.NodeSpec.parseDOM"><code>parseDOM</code></a> æ–¹æ³•ï¼Œè¿™æ · DOM èŠ‚ç‚¹å¯ä»¥è¢« parse æˆ ProseMirror çš„ nodeã€‚
ä¸‹é¢çš„ schema ä½¿ç”¨è‡ªå®šä¹‰çš„ <code>&lt;note&gt;</code> å’Œ <code>&lt;notegroup&gt;</code> è¿™ä¸¤ä¸ª DOM å…ƒç´ æ¥ä»£è¡¨ ProseMirror ä¸­å¯¹åº”çš„èŠ‚ç‚¹ï¼š</p>
<style>
  #text-editor { background-color: rgba(0, 0, 0, 0.05); padding: 0 }
  .ProseMirror { min-height: none !important }
  .ProseMirror a { text-decoration: underline; }
  note, notegroup { display: block; border: 1px solid silver; border-radius: 3px; padding: 3px 6px; margin: 5px 0; }
  notegroup { border-color: #66f }
  p.boring { background: #eee; color: #444; }
  shouting { display: inline; text-transform: uppercase; font-weight: bold; }
  star { display: inline; font-size: 190%; line-height: 1; vertical-align: -10%; color: #a8f; -webkit-text-stroke: 1px #75b; }
</style>
<div id="note-editor"></div>
<p>ä½ å¯ä»¥é€‰ä¸­å‡ ä¸ª notes åæŒ‰ ctrl-space æ¥å°†ä»–ä»¬æˆç»„ã€‚è¦å®ç°è¿™ä¸ªæ•ˆæœï¼Œä½ é¦–å…ˆåº”è¯¥å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ <a href="/docs/guide/#commands">ç¼–è¾‘å‘½ä»¤</a>ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-javascript"><span class="hl-keyword">import</span> {<span class="hl-def">findWrapping</span>} <span class="hl-keyword">from</span> <span class="hl-string">"prosemirror-transform"</span>

<span class="hl-keyword">function</span> <span class="hl-def">makeNoteGroup</span>(<span class="hl-def">state</span>, <span class="hl-def">dispatch</span>) {
  <span class="hl-comment">// è·å–é€‰æ‹©çš„èŠ‚ç‚¹çš„ ranges</span>
  <span class="hl-keyword">let</span> <span class="hl-def">range</span> <span class="hl-operator">=</span> <span class="hl-variable-2">state</span>.<span class="hl-property">selection</span>.<span class="hl-property">$from</span>.<span class="hl-property">blockRange</span>(<span class="hl-variable-2">state</span>.<span class="hl-property">selection</span>.<span class="hl-property">$to</span>)
  <span class="hl-comment">// æŸ¥çœ‹æ˜¯å¦å…è®¸ç”¨ note group åŒ…è£¹è¿™ä¸ª ranges</span>
  <span class="hl-keyword">let</span> <span class="hl-def">wrapping</span> <span class="hl-operator">=</span> <span class="hl-variable">findWrapping</span>(<span class="hl-variable-2">range</span>, <span class="hl-variable">noteSchema</span>.<span class="hl-property">nodes</span>.<span class="hl-property">notegroup</span>)
  <span class="hl-comment">// å¦‚æœä¸å…è®¸çš„è¯ï¼Œå‘½ä»¤ä¸ä¼šæ‰§è¡Œ</span>
  <span class="hl-keyword">if</span> (<span class="hl-operator">!</span><span class="hl-variable-2">wrapping</span>) <span class="hl-keyword">return</span> <span class="hl-atom">false</span>
  <span class="hl-comment">// å¦åˆ™ï¼Œdispatch ä¸€ä¸ª transactionï¼Œä½¿ç”¨ `wrap` æ–¹æ³•å¼€åˆ›å»ºä¸€ä¸ªå®ç°å®é™…çš„åŒ…è£¹è¡Œä¸ºçš„ step</span>
  <span class="hl-keyword">if</span> (<span class="hl-variable-2">dispatch</span>) <span class="hl-variable-2">dispatch</span>(<span class="hl-variable-2">state</span>.<span class="hl-property">tr</span>.<span class="hl-property">wrap</span>(<span class="hl-variable-2">range</span>, <span class="hl-variable-2">wrapping</span>).<span class="hl-property">scrollIntoView</span>())
  <span class="hl-keyword">return</span> <span class="hl-atom">true</span>
}
</code></pre>
<p>ä¸€ä¸ªåƒ <code>keymap({"Ctrl-Space": makeNoteGroup})</code> ä¸€æ ·çš„ <a href="/docs/ref/#keymap">keymap</a> å¯ä»¥å¯ç”¨è¯¥å‘½ä»¤ã€‚</p>
<p>å¯¹äº enter å’Œ backspace æŒ‰é”®çš„ <a href="/docs/ref/#commands.baseKeymap">é€šç”¨æŒ‰é”®ç»‘å®š</a> åœ¨è¿™ä¸ª schema ä¸­å¯ä»¥æ­£å¸¸è¿è¡Œ--
enter å°†ä¼šåˆ†éš”åœ¨å…‰æ ‡ä¸¤ä¾§çš„æ–‡æœ¬ blockï¼Œæˆ–è€…å¦‚æœå…‰æ ‡æ‰€åœ¨çš„ä½ç½®ä¸ºç©ºæ–‡æœ¬ blockï¼Œåˆ™ä¼šè¯•ç€å°†å…¶è„±ç¦»å…¶çˆ¶çº§èŠ‚ç‚¹ï¼Œ
å› æ­¤å¯ä»¥ç”¨æ¥ä»å½“å‰ notes group ä¸­é€€å‡ºï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ notesã€‚åœ¨ä¸€ä¸ªæ–‡æœ¬ block çš„å¼€å¤´æŒ‰ backspace ä¼šå°†æ–‡æœ¬ block è„±ç¦»å…¶çˆ¶çº§èŠ‚ç‚¹ï¼Œ
è¿™æ ·ä¹Ÿå¯ä»¥ç”¨æ¥å°†ä¸€ä¸ª note ä¸­ note group ä¸­ç§»é™¤ã€‚</p>
<h2>Groups and marksï¼ˆèŠ‚ç‚¹ç»„å’Œ marksï¼‰</h2>
<p>è®©æˆ‘ä»¬å†åšä¸€æ¬¡ï¼Œä¼´éšç€ start å’Œ shoutingï¼ˆä¸çŸ¥é“å•¥æ„æ€ï¼‰ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ª schema ä¸ä»…æœ‰æ–‡æœ¬ä½œä¸º inline èŠ‚ç‚¹ï¼Œ<em>start</em> ä¹Ÿæ˜¯ inline çš„èŠ‚ç‚¹ã€‚
ä¸ºäº†èƒ½å¤Ÿå®¹æ˜“çš„å¼•ç”¨æˆ‘ä»¬çš„è¿™ä¸¤ä¸ª inline èŠ‚ç‚¹ï¼Œä»–ä»¬å¯ä»¥è¢«å½’ä¸ºä¸€ç»„ï¼ˆä»ç„¶å«åš <code>ã€Œinlineã€</code>ï¼‰ã€‚
è¿™ä¸ª schema å°†é‡åˆ°çš„ä¸¤ç§ block èŠ‚ç‚¹ä¸€è§†åŒä»ï¼Œä¸€ä¸ªæ˜¯ <code>paragraph</code> ç±»å‹ï¼Œå®ƒå…è®¸ä»»ä½• inline å†…å®¹ï¼Œ
å¦ä¸€ç§æ˜¯ <code>boring_paragraph</code> ç±»å‹ï¼Œå®ƒåªå…è®¸æ²¡æœ‰ mark è®¾ç½®çš„æ–‡æœ¬å†…å®¹ï¼š</p>
<pre><code class="language-javascript"><span class="hl-keyword">let</span> <span class="hl-def">starSchema</span> <span class="hl-operator">=</span> <span class="hl-keyword">new</span> <span class="hl-variable">Schema</span>({
  <span class="hl-property">nodes</span>: {
    <span class="hl-property">text</span>: {
      <span class="hl-property">group</span>: <span class="hl-string">"inline"</span>,
    },
    <span class="hl-property">star</span>: {
      <span class="hl-property">inline</span>: <span class="hl-atom">true</span>,
      <span class="hl-property">group</span>: <span class="hl-string">"inline"</span>,
      <span class="hl-property">toDOM</span>() { <span class="hl-keyword">return</span> [<span class="hl-string">"star"</span>, <span class="hl-string">"ğŸŸŠ"</span>] },
      <span class="hl-property">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"star"</span>}]
    },
    <span class="hl-property">paragraph</span>: {
      <span class="hl-property">group</span>: <span class="hl-string">"block"</span>,
      <span class="hl-property">content</span>: <span class="hl-string">"inline*"</span>,
      <span class="hl-property">toDOM</span>() { <span class="hl-keyword">return</span> [<span class="hl-string">"p"</span>, <span class="hl-number">0</span>] },
      <span class="hl-property">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"p"</span>}]
    },
    <span class="hl-property">boring_paragraph</span>: {
      <span class="hl-property">group</span>: <span class="hl-string">"block"</span>,
      <span class="hl-property">content</span>: <span class="hl-string">"text*"</span>,
      <span class="hl-property">marks</span>: <span class="hl-string">""</span>,
      <span class="hl-property">toDOM</span>() { <span class="hl-keyword">return</span> [<span class="hl-string">"p"</span>, {<span class="hl-property">class</span>: <span class="hl-string">"boring"</span>}, <span class="hl-number">0</span>] },
      <span class="hl-property">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"p.boring"</span>, <span class="hl-property">priority</span>: <span class="hl-number">60</span>}]
    },
    <span class="hl-property">doc</span>: {
      <span class="hl-property">content</span>: <span class="hl-string">"block+"</span>
    }
  },
</code></pre>
<p>å› ä¸ºæ–‡æœ¬ block ç±»å‹çš„èŠ‚ç‚¹é»˜è®¤æƒ…å†µä¸‹å…è®¸ marksï¼Œå› æ­¤ <code>boring_paragraph</code> èŠ‚ç‚¹å°† <a href="/docs/ref/#model.NodeSpec.marks"><code>marks</code></a> è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä»¥æ˜ç¡®ç¦æ­¢å®ƒã€‚</p>
<p>ä¸‹é¢è¿™ä¸ª schema å®šä¹‰äº†ä¸¤ç§ç±»å‹çš„ marksï¼Œ<code>shouted text</code> å’Œ <code>links</code>ã€‚å‰è€…ç±»ä¼¼äºæ™®é€šçš„åŠ ç²— marksï¼Œå®ƒåªæ‰€åœ¨çš„å†…å®¹ä¸Šæ·»åŠ ä¸€ç‚¹ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰ä»»ä½• attributesã€‚
å®ƒåœ¨ DOM ä¸­è¢«æ¸²æŸ“æˆ <code>&lt;shouting&gt;</code> æ ‡ç­¾ï¼ˆæ ·å¼è¢«è®¾ç½®ä¸ºå†…è”ã€åŠ ç²—å’Œå¤§å†™ï¼‰ï¼ŒåŒæ—¶æœ‰è¯¥åå­—çš„ DOM æ ‡ç­¾åº”è¯¥è¢« parse æˆè¿™ä¸ª markï¼š</p>
<pre><code class="language-javascript">  <span class="hl-variable">marks</span>: {
    <span class="hl-variable">shouting</span>: {
      <span class="hl-variable">toDOM</span>() { <span class="hl-keyword">return</span> [<span class="hl-string">"shouting"</span>, <span class="hl-number">0</span>] },
      <span class="hl-variable">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"shouting"</span>}]
    },
    <span class="hl-variable">link</span>: {
      <span class="hl-variable">attrs</span>: {<span class="hl-variable">href</span>: {}},
      <span class="hl-variable">toDOM</span>(<span class="hl-variable">node</span>) { <span class="hl-keyword">return</span> [<span class="hl-string">"a"</span>, {<span class="hl-property">href</span>: <span class="hl-variable">node</span>.<span class="hl-property">attrs</span>.<span class="hl-property">href</span>}, <span class="hl-number">0</span>] },
      <span class="hl-variable">parseDOM</span>: [{<span class="hl-property">tag</span>: <span class="hl-string">"a"</span>, <span class="hl-property">getAttrs</span>(<span class="hl-def">dom</span>) { <span class="hl-keyword">return</span> {<span class="hl-property">href</span>: <span class="hl-variable-2">dom</span>.<span class="hl-property">href</span>} }}],
      <span class="hl-variable">inclusive</span>: <span class="hl-atom">false</span>
    }
  }
})
</code></pre>
<p>Links åˆ™ç¡®å®æœ‰ä¸€ä¸ª attributes--å®ƒä»¬çš„ urlï¼Œå› æ­¤å®ƒä»¬çš„ DOM åºåˆ—åŒ–çš„æ–¹æ³•éœ€è¦è¾“å‡ºè¿™ä¸ª attributes
ï¼ˆä» <code>toDOM</code> å‡½æ•°è¿”å›çš„æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡çš„è¯ï¼Œä¼šæä¾›ä¸€ä¸ª DOM attributes é›†åˆï¼‰ï¼ŒåŒæ—¶å®ƒä»¬çš„ DOM parser éœ€è¦è¯»å–è¿™ä¸ª attributesã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œmarks éœ€è¦ <em>inclusice</em> å±æ€§ï¼Œå®ƒè¡¨ç¤ºè¯¥ mark ä¼šåº”ç”¨åˆ°ç›´æ¥æ’å…¥åœ¨å®ƒä»¬åé¢çš„å†…å®¹ï¼ˆå¦‚æœè¿™äº› marks ä½äºå®ƒä»¬çˆ¶çº§èŠ‚ç‚¹çš„å¼€å§‹ä½ç½®çš„è¯ï¼Œä¹Ÿä¸€æ ·ä¼šåº”ç”¨ï¼‰ã€‚
å¯¹äº link ç±»å‹çš„ marksï¼Œè¿™é€šå¸¸ä¸æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼Œå› æ­¤è®¾ç½®åˆ°æ­¤ç±» marks ä¸Šçš„ <a href="/docs/ref/#model.MarkSpec.inclusive"><code>inclusive</code></a> å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸º false ä»¥ç¦æ­¢æ­¤è¡Œä¸ºã€‚</p>
<p>è¯‘è€…æ³¨ï¼šå‡è®¾æœ‰ mark bï¼š <code>&lt;b&gt;abc&lt;/b&gt;</code>ï¼Œç„¶åè¾“å…¥ <code>d</code>ã€‚å¦‚æœå…¶ <code>inclusive</code> å±æ€§æ˜¯ trueï¼Œåˆ™å…‰æ ‡æ”¾åˆ° <code>c</code> åé¢çš„æ—¶å€™è¾“å…¥çš„å†…å®¹ä¹Ÿè¢«å½“æˆæ˜¯ b mark çš„ä¸€éƒ¨åˆ†ï¼Œå³å˜æˆäº† <code>&lt;b&gt;abcd&lt;/&gt;</code>ï¼›
åŒç†ï¼Œå¦‚æœ b æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ª mark çš„è¯ï¼Œå¦‚ <code>&lt;p&gt;&lt;b&gt;abc&lt;/b&gt;&lt;/p&gt;</code>ï¼Œåˆ™å¾—åˆ° <code>&lt;p&gt;&lt;b&gt;dabc&lt;/b&gt;&lt;/p&gt;</code>ã€‚
å¦‚æœ b çš„ mark æ˜¯ <code>inclusive</code> æ˜¯ falseï¼Œåˆ™å…‰æ ‡æ”¾åˆ° <code>c</code> åé¢è¾“å…¥å†…å®¹ <code>d</code>ï¼Œåˆ™ä¼šå¾—åˆ°ç»“æœ <code>&lt;b&gt;abc&lt;/b&gt;d</code>ï¼Œ
åŒç†ï¼Œè‹¥æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ª mark çš„è¯ï¼Œ åˆ™å¾—åˆ°ï¼š<code>&lt;p&gt;d&lt;b&gt;abc&lt;/b&gt;&lt;/p&gt;</code>ï¼š</p>
<div id="star-editor" class="editor"></div>
<div style="display: none">
  <div id="text-content">Such as this sentence.</div>
  <div id="note-content">
    <note>Do laundry</note>
    <note>Water the tomatoes</note>
    <notegroup>
      <note>Buy flour</note>
      <note>Get toilet paper</note>
    </notegroup>
  </div>
  <div id="star-content">
    <p>This is a <star></star>nice<star></star> paragraph, it can have <shouting>anything</shouting> in it.</p>
    <p class="boring">This paragraph is boring, it can't have anything.</p>
    <p>Press ctrl/cmd-space to insert a star, ctrl/cmd-b to toggle shouting, and ctrl/cmd-q to add or remove a link.</p>
  </div>
</div>
<p><a href="https://glitch.com/edit/#!/remix/prosemirror-demo-schema"><img src="https://cdn.glitch.com/2703baf2-b643-4da7-ab91-7ee2a2d00b5b%2Fremix-button.svg" alt="Remix on Glitch"></a></p>
<p>ä¸ºäº†èƒ½ä¸è¿™äº›å…ƒç´ è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡çš„éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ keymapã€‚å¯¹äºæ‰“å¼€/å…³é—­ marksï¼Œæœ‰ä¸€ä¸ªç›´æ¥ä½¿ç”¨çš„å‘½ä»¤è¾…åŠ©å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¯¹ shouting mark ä½¿ç”¨è¿™ä¸ªè¾…åŠ©å‡½æ•°äº†ï¼š</p>
<pre><code class="language-javascript"><span class="hl-keyword">import</span> {<span class="hl-def">toggleMark</span>} <span class="hl-keyword">from</span> <span class="hl-string">"prosemirror-commands"</span>
<span class="hl-keyword">import</span> {<span class="hl-def">keymap</span>} <span class="hl-keyword">from</span> <span class="hl-string">"prosemirror-keymap"</span>

<span class="hl-keyword">let</span> <span class="hl-def">starKeymap</span> <span class="hl-operator">=</span> <span class="hl-variable">keymap</span>({
  <span class="hl-string hl-property">"Ctrl-b"</span>: <span class="hl-variable">toggleMark</span>(<span class="hl-variable">starSchema</span>.<span class="hl-property">marks</span>.<span class="hl-property">shouting</span>),
  <span class="hl-string hl-property">"Ctrl-q"</span>: <span class="hl-variable">toggleLink</span>,
  <span class="hl-string hl-property">"Ctrl-Space"</span>: <span class="hl-variable">insertStar</span>
})
</code></pre>
<p>æ‰“å¼€/å…³é—­ä¸€ä¸ª link å®é™…ä¸Šæ˜¯æœ‰ç‚¹å¤æ‚çš„ã€‚å½“ä»€ä¹ˆä¹Ÿæ²¡é€‰ä¸­çš„æ—¶å€™ï¼Œå¯ç”¨æˆ–è€…ç¦ç”¨ä¸€ä¸ª inclusive ä¸º false çš„ marks æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå› ä¸ºä½ ä¸èƒ½å°†å†…å®¹ã€Œè¾“å…¥è¿›ã€è¿™ç§ marksï¼ˆå°±åƒ inclusive ä¸º true åšçš„é‚£æ ·ï¼‰ã€‚
æ­¤å¤–æˆ‘ä»¬è¿˜éœ€è¦è®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ª URL--ä½†æ˜¯å‰ææ˜¯å¾—å…ˆæ·»åŠ ä¸€ä¸ª linkã€‚å› æ­¤æ‰“å¼€/å…³é—­ links çš„å‘½ä»¤ä¼šåœ¨è¯·æ±‚ç”¨æˆ·è¾“å…¥ URL ä¹‹å‰ä½¿ç”¨ <a href="/docs/ref/#model.Node.rangeHasMark"><code>rangeHasMark</code></a> å»æ£€æŸ¥ link mark æ˜¯å¦å°†è¦è¢«æ·»åŠ æˆ–è€…ç§»é™¤ã€‚</p>
<p>ï¼ˆ<code>è¯·æ±‚ç”¨æˆ·</code> è¿™ç§äº¤äº’é€»è¾‘å¯èƒ½åœ¨çœŸå®çš„ç³»ç»Ÿæ˜¯å¹¶ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚å½“ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•è®©ç”¨æˆ·è¾“å…¥ä¸€äº›ä¿¡æ¯ç„¶ååº”ç”¨çš„æ—¶å€™ï¼Œä½ éœ€è¦ç¡®ä¿è¯¥æ—¶åˆ»ä½¿ç”¨çš„æ˜¯ <em>å½“å‰æœ€æ–°çš„</em> stateï¼Œè€Œä¸æ˜¯å½“å‘½ä»¤è¢«è°ƒç”¨æ—¶åˆ»çš„ stateã€‚ï¼‰</p>
<pre><code class="language-javascript"><span class="hl-keyword">function</span> <span class="hl-def">toggleLink</span>(<span class="hl-def">state</span>, <span class="hl-def">dispatch</span>) {
  <span class="hl-keyword">let</span> {<span class="hl-def">doc</span>, <span class="hl-def">selection</span>} <span class="hl-operator">=</span> <span class="hl-variable-2">state</span>
  <span class="hl-keyword">if</span> (<span class="hl-variable-2">selection</span>.<span class="hl-property">empty</span>) <span class="hl-keyword">return</span> <span class="hl-atom">false</span>
  <span class="hl-keyword">let</span> <span class="hl-def">attrs</span> <span class="hl-operator">=</span> <span class="hl-atom">null</span>
  <span class="hl-keyword">if</span> (<span class="hl-operator">!</span><span class="hl-variable-2">doc</span>.<span class="hl-property">rangeHasMark</span>(<span class="hl-variable-2">selection</span>.<span class="hl-property">from</span>, <span class="hl-variable-2">selection</span>.<span class="hl-property">to</span>, <span class="hl-variable">starSchema</span>.<span class="hl-property">marks</span>.<span class="hl-property">link</span>)) {
    <span class="hl-variable-2">attrs</span> <span class="hl-operator">=</span> {<span class="hl-property">href</span>: <span class="hl-variable">prompt</span>(<span class="hl-string">"Link to where?"</span>, <span class="hl-string">""</span>)}
    <span class="hl-keyword">if</span> (<span class="hl-operator">!</span><span class="hl-variable-2">attrs</span>.<span class="hl-property">href</span>) <span class="hl-keyword">return</span> <span class="hl-atom">false</span>
  }
  <span class="hl-keyword">return</span> <span class="hl-variable">toggleMark</span>(<span class="hl-variable">starSchema</span>.<span class="hl-property">marks</span>.<span class="hl-property">link</span>, <span class="hl-variable-2">attrs</span>)(<span class="hl-variable-2">state</span>, <span class="hl-variable-2">dispatch</span>)
}
</code></pre>
<p>æ’å…¥ä¸€ä¸ª star çš„å‘½ä»¤é¦–å…ˆæ£€æŸ¥ schema æ˜¯å¦å…è®¸ä¸€ä¸ª star æ’å…¥å…‰æ ‡æ‰€åœ¨çš„ä½ç½®ï¼ˆä½¿ç”¨ <a href="/docs/ref/#model.Node.canReplaceWith"><code>canReplaceWith</code></a> æ–¹æ³•ï¼‰ï¼Œå¦‚æœå…è®¸çš„è¯ï¼Œ
åˆ™ç”¨æ–°åˆ›å»ºçš„ star èŠ‚ç‚¹æ›¿æ¢é€‰åŒºï¼š</p>
<pre><code class="language-javascript"><span class="hl-keyword">function</span> <span class="hl-def">insertStar</span>(<span class="hl-def">state</span>, <span class="hl-def">dispatch</span>) {
  <span class="hl-keyword">let</span> <span class="hl-def">type</span> <span class="hl-operator">=</span> <span class="hl-variable">starSchema</span>.<span class="hl-property">nodes</span>.<span class="hl-property">star</span>
  <span class="hl-keyword">let</span> {<span class="hl-def">$from</span>} <span class="hl-operator">=</span> <span class="hl-variable-2">state</span>.<span class="hl-property">selection</span>
  <span class="hl-keyword">if</span> (<span class="hl-operator">!</span><span class="hl-variable-2">$from</span>.<span class="hl-property">parent</span>.<span class="hl-property">canReplaceWith</span>(<span class="hl-variable-2">$from</span>.<span class="hl-property">index</span>(), <span class="hl-variable-2">$from</span>.<span class="hl-property">index</span>(), <span class="hl-variable-2">type</span>))
    <span class="hl-keyword">return</span> <span class="hl-atom">false</span>
  <span class="hl-variable-2">dispatch</span>(<span class="hl-variable-2">state</span>.<span class="hl-property">tr</span>.<span class="hl-property">replaceSelectionWith</span>(<span class="hl-variable-2">type</span>.<span class="hl-property">create</span>()))
  <span class="hl-keyword">return</span> <span class="hl-atom">true</span>
}
</code></pre>
<link rel=stylesheet href="../../css/editor.css">
<script src="../prosemirror.js"></script>
<script src="example.js"></script></article>

<footer>
  <nav>
    <a class=logo href=".">ProseMirror</a>
    <div class=navlinks>
      <a href="/backers.html">æ”¯æŒè€…</a>
      <a href="http://contributor-covenant.org/version/1/1/0/">ä»£ç è´¡çŒ®å…¬çº¦</a>
      <a href="https://discuss.prosemirror.net/">å®˜æ–¹è®ºå›</a>
      <a href="https://github.com/prosemirror/prosemirror/issues">æŠ¥å‘Šé”™è¯¯</a>
      <a href="https://github.com/xheldon-prosemirror/prosemirror/issues">æŠ¥å‘Šç¿»è¯‘é”™è¯¯</a>
    </div>
  </nav>
</footer>

</html>